# Key

Key란, 테이블의 행(row)을 고유하게 식별하거나, 테이블 간의 관계를 정의하기 위해 사용되는 하나 이상의 열(column)이다. 

## Key의 종류

- 후보키
- 기본키
- 대체키
- 슈퍼키
- 외래키
- 복합키
- 유니크키

## 후보키

릴레이션(테이블)을 구성하는 속성(열)들 중에서 튜플을 유일하게 식별할 수 있는 속성들의 부분집합을 의미한다. 

### 특징

- 모든 릴레이션은 반드시 하나 이상의 후보키를 가져야 한다.
- 테이블에 있는 모든 튜플(행)에 대해서 **유일성**과 **최소성**을 만족시켜야 한다.
- 여러개의 **후보키**가 있을 수 있으며, 그 중 하나가 **기본키**가 된다.

예) 

![스크린샷 2024-11-14 오후 9.34.00.png](/Database/img/student_table.png)

![여기서 학번은 학생 테이블의 외래키임](/Database/img/course_table.png)

여기서 학번은 학생 테이블의 외래키임

예) <학생> 릴레이션(테이블)에서 ‘학번’ or ‘주민번호’는 다른 레코드를 유일하게 구별할 수 있는 기본 키로 사용할 수 있으므로 후보키가 될 수 있다. 즉 기본키가 될 수 있는 키들을 후보키라 한다. 

## 기본키

후보키들 중에서 하나를 선택한 키로 **최소성**과 **유일성**을 만족해야 한다. 

`최소성` : 키를 구성하는 속성들이 최소한의 속성들로 이루어져 있어야 한다는 성질

`유일성` : 테이블에서 특정 키가 모든 행을 **유일하게 식별**할 수 있는 성질

### 특징

- 테이블에서 기본키는 오직 1개만 지정할 수 있다.
- 기본키는 절대 `NULL` 값을 가질 수 없고, 중복된 값을 가질 수 없다.

 예) <학생> 테이블의 학번이 기본키가 될 수 있다.

## 대체키

후보키가 두개 이상일 경우 그 중에서 어느 하나를 기본키로 지정하고 남은 후보키들을 대체키라 한다.

예) <학생>테이블에서 학번이 기본키가 되면 주민번호는 대체키가 된다. 

## 슈퍼키

테이블 행을 **고유하게 식별할 수 있는 하나 이상**의 칼럼 조합이다. 

### 특징

- 모든 **기본키**와 **후보키**는 **슈퍼키**이다.
    - 슈퍼키는 후보키와 기본키를 결정하기 전 단계에서 모든 가능한 키의 후보를 찾을 때 유용하다.
    - 실제 DB 설계에서는 최소성을 만족하는 후보키를 찾아서 그중 하나를 기본키로 설정하는 것이 일반적이다.
- **슈퍼키**는 최소성을 만족하지 않을 수도 있다. (유일성은 보장한다.)

<학생> 테이블에서 학번만으로도 슈퍼키가 될 수 있다. 

학번 + 이름도 슈퍼키가 된다. (하지만, 이 경우에는 최소성을 만족하지 않는다. 학번 or 주민번호만으로도 슈퍼키를 만들 수 있으니까)

![스크린샷 2024-11-14 오후 9.47.27.png](/Database/img/key_type.png)

즉 **후보키** 중에서 선택된 것을 **기본키**, 나머지를 **대체키**라고 한다.

그리고 한 개 이상의 조합으로 행을 고유하게 식별 가능한 것을 **슈퍼키**라고 한다.

## 외래키

다른 테이블의 **기본키**를 참조하는 키이다. 테이블 간의 관계를 정의할 때 사용된다. 

### 특징

- 부모 테이블의 기본키와 연결된다.
- 외래키의 값은 부모 테이블의 키값 중 하나와 일치하거나 NULL이 될 수 있다.
- 외래키로 지정되면 참조 테이블의 기본키에 없는 값은 입력할 수 없다. (참조 무결성 조건)
- 외래키를 가진 테이블도 기본키가 필요하다. (외래키가 테이블의 고유성을 보장하지 않기 때문에 → 동일한 외래키를 여러 Row가 가질 수 있음)

예) <수강> 테이블의 학번은 **외래키**이고, <학생> 테이블의 학번은 **기본키**이다. 

## 복합키

두 개 이상의 칼럼을 묶어서 하나의 기본키로 지정하는 것을 말한다. 

### 특징

- 기본키는 하나의 테이블에 하나만 존재 할 수 있다, 또한 기본키는 하나 이상의 칼럼으로 구성되어 있다.
    - 만약 복합키가 기본키라면, 복합키 또한 최소성과 유일성을 만족해야 한다.
    
    ex) 국제 도서 대여 서비스를 운영하는 회사에서는 여러 나라의 여러 도서관에서 도서 대여 정보를 관리하고 있다. 한 도서관 내에서는 도서 코드만으로도 도서를 구분할 수 있지만, 전세계의 모든 도서관을 고려할 때 동일한 도서 코드를 가진 책이 존재할 수 있다. 따라서 각 대여 정보를 구분하기 위해 '도서관 코드'와 '도서 코드' 두 개의 칼럼을 결합하여 복합키를 생성한다.
    
    도서관 코드 + 도서 코드 ⇒ 복합키 and 기본키 
    

## 유니크키

각 행을 유일하게 식별할 수 있는 열 또는 열의 조합을 의미한다. 

- 값이 중복될 수 없음을 보장한다.
- 한 테이블에 여러 개의 유니크키를 가질 수 있다.
- `NULL` 값을 가질 수 있다. (서로 다른 NULL로 인식을 한다.)

```sql
CREATE TABLE users (
    id INT PRIMARY KEY,
    email VARCHAR(255) UNIQUE,
    username VARCHAR(100) UNIQUE,
    phone_number VARCHAR(15)
);
```

### 면접 질문

- 슈퍼키, 후보키, 기본키의 차이점에 대해 설명해주세요.
- 기본키와 유니크 키의 차이점은 무엇인가요?
- DB 설계시 키를 잘못 설정하면 발생할 수 있는 문제는 무엇인가요?
    - **중복 데이터**가 발생할 수 있음.
    - **데이터 무결성**이 깨질 수 있음.
    - **성능 문제**: 인덱싱이 잘못 설정되면 검색, 삽입, 삭제 성능이 저하될 수 있음.


### 참고 자료
- [[DataBase] 키(Key)의 개념 및 종류](https://limkydev.tistory.com/108)
  
- [복합키란 무엇인가?](https://shin-e-dog.tistory.com/66)