# TCP의 연결 및 해제 과정(3,4-way handshake)

## 목차

* TCP란?
* TCP의 특성 
* 3-way handshake
* 4-way handshake
* UDP란?
* 정리 
* 예상 면접 질문 
* 참고 자료 

### TCP란? 
TCP(전송 제어 프로토콜)은 두 개의 호스트를 연결하고 데이터 스트림을 교환하게 해주는 중요한 네트워크 프로토콜이다. 
데이터의 전송여부, 순서를 보장하기 위해 정보 전달을 통제한다. 

<br>

### TCP의 특성 

**신뢰성 보장**

데이터의 **손실, 중복, 순서 변경** 등의 문제를 해결하여, 정확하게 수신자에게 도달하도록 보장한다. 

데이터를 **세그먼트** 단위로 나누어 전송하며, 각 세그먼트에 번호를 부여한다. 이 순서 번호를 이용해 데이터를 재조립하여 원래 데이터로 복구한다. 

**체크섬** 필드를 통해, 데이터가 전송 중에 손상되었는지 확인할 수 있다. 

**3-way handshake**를 통해 데이터 전송 시작하기 전에 연결을 설정한다. 

**흐름 제어**

송신자가 데이터를 너무 빠르게 보내는 경우 수신자가 처리할 수 없는 상황을 방지하는 메커니즘이다. 

송신자가 수신자의 처리 속도에 맞춰 데이터를 전송할 수 있도록 흐름 제어를 적용한다.

슬라이딩 윈도우 기법: 한 번에 전송할 수 있는 데이터의 양을 조절한다. 이를 통해 송신자가 적절한 양의 데이터를 보낼 수 있다.

<br>

### 3-way handshake

![](/Network/img/network_3_way_handshake.png)

데이터를 전송하기 전에 먼저 상대방과 연결을 설정하고 데이터를 주고받을 준비가 되었음을 확인하는 과정이다.  

이를 통해 신뢰성 있는 연결을 설정할 수 있다. 

<br>

**1단계 SYN(Synchronize) - 연결 요청**

송신자가 수신자에게 SYN 패킷을 보낸다. 이 패킷은 연결을 시작하고 싶다는 신호이다. 

SYN 패킷안에 시퀸스 번호가 포함되어 있다. 이 시퀸스 번호를 통해 수신자가 데이터 수신을 추적할 수 있도록 한다. 

<br>

**2단계 SYN-ACK(Synchroize-Acknowledge) - 연결 요청 수락**

수신자가 SYN 패킷을 수신하면, SYN-ACK 패킷을 보낸다. 이 패킷은 송신자의 연결 요청을 수락한다는 의미이며, 
동시에 자신도 연결을 설정하려고 한다는 신호이다. 

서버의 시퀸스 번호와 함께 송신자가 보낸 시퀸스 번호에 대한 확인 응답 번호(ACK)도 포함된다.
이는 송신자가 보낸 데이터를 성공적으로 받았음을 나타낸다. 

<br>

**3단계 ACK(Acknowledge) - 연결확정**

송신자가 수신자로부터 SYN-ACK 패킷을 수신하면, 다시 수신자에게 ACK 패킷을 전송한다. 
이 ACK 패킷도 서버의 시퀸스 번호에 대한 확인 응답이 포함되어 있다. 

<br>

### 4-way handshake
![](/Network/img/network_4_way_handshake.png)

3-way handshake가 연결 시작 과정이라면, 4-way handshake는 연결을 안전하게 종료하는 과정이다. 

**1단계 FIN(Finish) - 연결 종료 요청**

송신자가 FIN 패킷을 전송하여 연결을 종료하고 싶다는 의사를 나타낸다. 데이터 전송을 마쳤다는 신호이다. 

<br>

**2단계 ACK(Acknowledge) - FIN 확인 응답**

수신자는 FIN 패킷을 수신하면 송신자에게 ACK 패킷을 전송하여 FIN 패킷을 확인했음을 알린다. 

하지만 수신자는 여전히 데이터를 보낼 수 있으며, 자신의 연결을 아직 종료하지 않은 상태이다. 

<br>

**3단계 수신자의 FIN(Finish) - 연결 종료 요청**

수신자도 더 이상 보낼 데이터가 없으면 FIN 패킷을 송신자에게 전송한다. 이제 수신자도 자신의 연결을 종료할 준비가 되었다는 의미이다. 

<br>

**4단계 ACK(Acknowledge) - 수신자의 FIN 확인 응답**

송신자는 수신자의 FIN 패킷을 수신한 후, ACK 패킷을 전송하여 연결 종료 요청을 확인한다. 이로써 양쪽 모두 데이터 전송이 완료되고, TCP 연결이 종료된다. 

<br>

### UDP란?

UDP(User Datagram Protocol)는 TCP와 다르게 빠른 데이터 전송을 목적으로 설계되었다. 

비연결 방식으로 두 송수신자를 따로 사전 연결 하지 않는다. 그 과정에서 데이터가 손실될 가능성이 있지만, 그 대신 훨씬 빠른 속도를 얻을 수 있다. 

스트리밍 서비스에서 주로 사용한다. TCP와 달리 재전송이 없기 때문에 끊김 없는 스트리밍이 가능하다. 

온라인 게임에서도 실시간 상호작용을 위해 데이터를 전송하기 위해 사용한다. 

DNS와 같이 도메인 이름을 IP 주소로 변환하는 과정에서도 사용된다. 웹사이트에 접속할 때 빠른 응답이 요구 되기 때문이다. 
요청과 응답이 매우 작기때문에 요청이 실패할 경우 브라우저가 다시 시도하면 되기 때문에 재전송 매커니즘이 필요하지 않다. 
헤더에 포함되는 정보가 많이 필요없기 때문에 적은 오버헤드를 가지고 있다. 


### 정리 

TCP/IP 프로토콜은 인터넷 통신을 기반으로 사용되는 실용적인 네트워크 모델이다.
TCP와 UDP를 통해 데이터 전송을 관리할 수 있다. TCP의 3-way handshake는 송수신자간의 연결 시작 과정을 의미한다.
4-way handshake는 데이터를 모두 보내고 종료하기 위해 실행되는 과정이다. 

TCP는 신뢰성있고 정확한 데이터 전송을 목적으로 사용된다. 반면 UDP는 빠른 데이터 전송을 목적으로 설계되었다. 


### 예상 질문 

* TCP와 UDP의 차이점이 무엇인가요?
* 3-way handshake와 4-way handshake에 대해 알고 있는대로 설명해주세요. 
* DNS는 어떤 전송 프로토콜을 사용하나요? 그리고 그 프로토콜을 사용하는 이유를 설명해주세요.


### 참고 자료

[[10분 테코톡] 👨‍🏫르윈의 TCP UDP](https://www.youtube.com/watch?v=ikDVGYp5dhg)


[UDP vs TCP (스타크래프트)](https://velog.io/@ghwns1007/UDP-vs-TCP-%EC%8A%A4%ED%83%80%ED%81%AC%EB%9E%98%ED%94%84%ED%8A%B8)