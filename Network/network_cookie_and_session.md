# 쿠키와 세션

## HTTP 프로토콜의 특징

### Connectionless(비연결지향)

 HTTP 프로토콜은 클라이언트에서 요청(Request)를 보내면 서버가 응답(Response)을 하고 연결을 끊는다.

### Stateless(무상태성)

 HTTP 프로토콜은 연결이 끊어지면 클라이언트와 서버의 통신이 끝나고 상태 정보를 유지하지 않는다.

## 쿠키(Cookie)와 세션(Session)을 사용하는 이유

 쿠키와 세션은 HTTP 프로토콜의 특징의 약점을 보완하기 위해서 사용한다.

→ Connectionless(비연결지향)과 Stateless(무상태성)이라는 특징을 갖기 때문에 만약 사용자가 다른 페이지로 넘어가게 되는 경우에 로그인 정보가 사라져 매 페이지마다 로그인을 해야하는 대참사가 발생할 수도 있기때문이다.

## 쿠키(Cookie)

  HTTP 쿠키는 웹 서버에 의해 사용자의 컴퓨터에 저장되는, 이름을 가진 작은 크기의 **데이터**이다.

### 쿠키의 특징

- Key-Value 쌍으로 구성되어 있는 데이터 파일이다.
- 쿠키 이름, 쿠키 값, 만료 시간, 전송할 도메인 명, 전송할 경로, 보안 연결 여부, HttpOnly 여부로 구성되어있다.
- 도메인 당 20개의 쿠키를 가질 수 있다.
- 하나의 쿠키는 4KB(= 4096 byte)까지 저장이 가능하다.

### 쿠키의 작동 방식

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/be0198d7-dcc4-468c-b22d-abd7eefc4914/5c42f5cf-5cd7-4ce4-b82d-6f7c2a0f163e/image.png)

1. 클라이언트가 서버에 로그인 요청을 한다.
2. 서버가 로그인 요청의 유효성(Id, Pw 검사)을 확인하고 응답헤더에 set-cookie: 를 통해 쿠키를 추가하여 응답한다.
3. 클라이언트는 이후 추가적인 요청을 할 때 요청헤더에 전달받은 쿠키를 자동으로 추가하여 요청한다. 헤더에 쿠키값을 자동으로 추가하여 주는데 이는 브라우저에서 처리해주는 작업이다.

⇒ 쿠키는 기한이 정해져있지 않고 명시적으로 지우지 않는다면 반영구적으로 쿠키가 남아있다.

### 쿠키의 사용 목적

1. 세션 관리 (Session Management) 
    - 로그인, 사용자 닉네임, 접속 시간, 장바구니 등 서버가 알아야 할 정보들을 저장
2. 개인화 (Personalization)
    - 사용자마다 다르게 그 사람에게 적절한 페이지를 보여줄 수 있다.
        
        → 맞춤형 광고 (광고용 쿠키 사용)
        
3. 트래킹 (Tracking)
    - 사용자의 행동과 패턴을 분석하고 기록한다.

### 쿠키의 종류

- Session Cookie : 일반적으로 만료시간을 설정하고 메모리에만 저장되며, 브라우저 종료 시 쿠키를 삭제한다.
- Persistent Cookie : 장기간 유지되는 쿠키이다. 파일로 저장되어 브라우저 종료와 관계없이 사용할 수 있다.
- Secure Cookie : HTTPS 프로토콜에서만 사용하고, 쿠키 정보가 암호화 되어 전송된다.
- Third-Party Cookie : 방문한 도메인과 다른 도메인의 쿠키이다. 일반적으로 광고 배너 등을 관리할 때 유입 경로를 추적하기 위해 사용한다.

### 쿠키값 확인 및 단점

 브라우저 개발자 도구의 네트워크에서 쿠키 값을 확인할 수 있지만, 가독성이 굉장히 떨어지고 수정이 불가능하다. 하지만 ‘브라우저의 쿠키 관리 탭’ 또는 ‘쿠키 관리 플러그인’을 설치하면 쿠키를 쉽게 수정할 수 있다.

→ 쿠키는 클라이언트에서 충분히 수정이 가능하기 때문에 위변조의 위험이 항상 존재한다. 따라서 쿠키 값을 암호화 해야하고, 민감하거나 중요한 정보는 담지 않도록 해야한다.

## 세션 (Session)

 일정 시간 동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 유지시키는 기술이다.

→ 일정 시간 : 사용자가 웹 부라우저를 통해 웹 서버에 접속한 시점부터 웹 브라우저를 종료하여 연결을 끝내는 시점을 말한다. 

### 세션의 특징

- 웹 서버에 **웹 컨테이너의 상태**를 유지하기 위한 정보를 저장한다.
- 웹 서버에 저장되는 쿠키(세션 쿠키 / Session Cookie) 이다.
- 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제가 되기 때문에 쿠키보다 비교적 보안적으로 우수하다.
- 저장 데이터에 제한이 없다. (서버 용량 허용 범위 내에서)
- 각 클라이언트에 고유 세션 ID (Session ID)를 부여한다. 세션 ID를 통해 클라이언트를 구분하여 각 요구에 맞는 서비스를 제공한다.

### 세션의 작동 방식

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/be0198d7-dcc4-468c-b22d-abd7eefc4914/02348a98-e8ea-4269-8863-5ddb70ff2644/image.png)

1. 클라이언트가 서버에 로그인 요청을 한다.
2. 서버에서 클라이언트의 로그인 요청의 유효성을 확인하고(Id, Pw 검사) 유일한 id를 Session ID로 생성하여 저장한다. (Session ID도 보냈는지 확인 후 존재하지 않는다면 생성해서 보내준다.)
3. 서버가 응답할 때 응답헤더에 세션 ID를 쿠키에 추가하여 응답한다.
4. 클라이언트는 이후 요청에서 자동으로 요청 헤더에 전달받은 세션 ID를 쿠키에 추가하여 요청한다.
5. 서버는 요청 헤더의 세션 ID 값을 저장된 세션저 장소에서 찾아보고 유효한 지 확인 후 요청을 처리하고 응답한다.

### 세션의 목적 및 단점

목적 : 다른 사용자에게 노출되면 안되는 보안적으로 중요한 정보들을 서버 안에서 다루기 위해 사용한다.

단점 : 세션의 내용이 서버에 저장되기 때문에 세션이 늘어날 경우에 서버에 부하가 발생할 수 있다. 또한 세션에 대한 정보가 서버에 저장되어있어 쿠키에 비해 속도가 느리다.

## 쿠키 VS 세션

|  | 쿠키 (Cookie) | 세션 (Session) |
| --- | --- | --- |
| 저장 위치 | 클라이언트 | 서버 |
| 저장 형식  | Text | Object |
| 만료 시점 | 만료기간이 있지만 파일로 저장되기 때문에 브라우저를 종료해도 정보가 유지될 수 있음. 또한 만료기간을 따로 지정해 쿠키를 삭제할 때까지 유지할 수도 있음 | 만료기간을 정할 수 있지만, 브라우저가 종료되면 만료기간에 상관없이 삭제됨 |
| 용량 제한 | 한 도메인 당 20개, 한 쿠키 당 4KB | 제한 없음 |
| 속도 | 쿠키에 정보가 있어 비교적 빠름 | 정보가 서버에 있어 비교적 느림 |

## 쿠키와 세션을 모두 사용하는 이유

 세션이 서버에 저장되므로 쿠키에 비해 보안이 높은 편이나, 쿠키는 클라이언트 메모리 or 파일로 저장되고 세션은 서버에 저장되어 서버 자원의 한계가 있고, 속도가 느려질 수 있다.

→ 자원관리 차원에서 쿠키와 세션을 적절한 요소 및 기능에 병행 사용하여 서버자원의 낭비를 방지하며 웹사이트의 속도를 높일 수 있다.

예상 질문
1. 쿠키와 세션의 차이가 무엇인가?
2. 왜 쿠키와 세션 둘 다 사용하는 이유는 무엇인가?
3. 쿠키와 세션을 사용하는 HTTP 프로토콜의 특징이 무엇인가?
