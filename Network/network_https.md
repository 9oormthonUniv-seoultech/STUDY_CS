# HTTPS

### 목차
* HTTP
* HTTPS
* 암호화 방식
  * 공개키 암호화 방식
  * 대칭키 암호화 방식
* TLS handshake
* HTTPS의 장단점
* 예상 면접 질문
* 참고 자료
---

### HTTP
> HyperText Transfer Protocol
HTTP 프로토콜의 최상위에 TLS암호화를 구현한 것

- WWW 상에서 웹 브라우저(클라이언트)와 서버 간 하이퍼텍스트를 전송하기 위해 사용되는 통신 규약이다. 인터넷에서 HTML과 같은 문서를 사용자 컴퓨터에 설치된 웹 브라우저가 웹 서버에 요청할 때의 규칙을 정의한다.
- HTTP는 정보를 **평문 텍스트(암호화되지 않은 텍스트)** 로 주고받기 때문에 네트워크에서 전송 신호를 인터셉트할 경우 내용이 노출될 수 있다. 이는 보안 취약점을 야기하므로, 이를 해결하기 위해 **HTTP에 S(secure socket)가 추가된 HTTPS**가 사용된다.
> HTTP 서버는 기본 포트인 80번 포트에서 서비스를 대기하고 있으며, 클라이언트(웹 브라우저)가 TCP 80 포트를 사용해 연결하면 서버는 요청에 응답하면서 자료를 전송한다.

<br>

![](/Network/img/network_http_vs_https.png)

### HTTPS
HTTPS는 HTTP 프로토콜의 최상위에 **TLS 암호화를 구현**한 것이다. 인터넷 상에서 정보를 암호화하기 위해 SSL프로토콜이나 TLS 프로토콜을 통해 세션 데이터를 암호화하여 웹 브라우저와 서버가 데이터를 주고받는 통신 규약이다.
- SSL, TLS 프로토콜을 적용하기 위해 서버는 인증서를 받아 서버에 적용시켜야 한다.
- 서버와 클라이언트 사이의 **모든 통신 내용이 암호화**되며, 페이지를 암호화한 키는 그 페이지를 보는 특정 사용자에게만 알려지도록 한다.

> 기본 TCP/IP 포트는 443번이며, SSL 프로토콜 위에서 HTTPS 프로토콜이 동작한다.

<br>

### 암호화 방식
#### 공개키 암호화 방식
![](/Network/img/network_public_key.png)

공개키 암호화 방식에서는 A 키로 암호화하면 B 키로 복호화하고, B 키로 암호화하면 A 키로 복호화한다. 이 중 하나는 비공개키(개인키)로 자신만 가지고 있으며 공개되지 않는다. 나머지 하나는 공개키로, 타인에게 제공된다. 공개키는 유출되어도 비공개키를 모르면 복호화할 수 없어서 안전하다. 두 키는 복호화하는 알고리즘이 다르며, 이 두 키의 쌍을 key pair라고 부른다. 공개키 암호화 방식은 느리지만 여러 사용자에게 키를 배포하기 더 쉽다.

1. 공개키 등록
    - 서버는 공개키와 개인키를 가지고 있다.
    - 공개키 저장소에 서버의 공개키를 등록한다.
    - 브라우저는 공개키 저장소(CA)에서 서버의 공개키를 가져온다.

<br>

2. 공개키를 이용한 데이터 암호화 및 복호화
    - 브라우저는 평문을 공개키로 암호화하여 HTTP 요청(즉, HTTPS 프로토콜을 사용한 요청)을 서버에 보낸다.
    - 그 암호문이 서버에 전달되면 서버는 서버의 개인키로 암호문을 복호화하여 평문 요청을 읽는다.
    - 오직 서버만 데이터 내용을 읽을 수 있다.

<br>

3. 전자서명
![](/Network/img/network_digital_signature.png)
    - 서버는 자신의 개인키로 데이터에 서명하여 클라이언트에 전달한다.
    - 클라이언트는 공개키를 이용해 전자서명을 검증한다. 무결성과 신뢰성을 확인할 수 있다. 

<br>

#### 대칭키 암호화 방식
대칭키 암호화 방식에서는 동일한 키로 암호화하고 복호화한다. 대칭키는 매번 랜덤으로 생성되어 누출되더라도 다음에 사용할 때는 다른 키가 사용되기 때문에 안전하다. 공개키의 느린 단점을 보완하여 빠르게 통신할 수 있다. 그러나 키의 보안 배포와 관련된 복잡성으로 인해 확장 가능한 형태의 암호화가 아니다.

<br>

### TLS 과정

TLS(Transport Layer Security)는 HTTPS 통신의 핵심 보안 기술로, 클라이언트와 서버 간의 데이터 전송을 암호화해 안전성을 보장한다.
   ```
    [TLS 과정]
    1) 핸드셰이크 : 암호화 통신을 위한 준비 과정   (서로 인증, 키 교환)
    2) 키 데리베이션 : 핸드셰이크에서 교환한 정보를 바탕으로 대칭키 생성
    3) 데이터 전송 : 세션 키를 사용하여 암호화된 데이터 전송

    TLS는 이러한 과정을 통해 데이터의 기밀성과 무결성을 보장하며, HTTPS 통신을 안전하게 유지한다
   ```
![](/Network/img/network_tls_handshake.png)
![](/Network/img/network_tls_session_key.png)
1. **핸드셰이크 과정**

    핸드셰이크는 TLS 통신의 첫 번째 단계로, 클라이언트와 서버가 암호화 통신을 설정하기 위해 서로를 인증하고, 암호화에 사용할 키를 교환한다. 이 과정은 대칭키를 안전하게 교환하기 위해 `공개키 암호화 방식`을 사용한다.
    - **Client Hello :** 

        클라이언트가 서버에 TLS 버전, 지원하는 암호화 알고리즘(사이퍼 스위트), 무작위 값(Client Random)을 포함한 "헬로" 메시지를 보낸다.
    - **Server Hello :** 
    
        서버는 선택한 암호화 알고리즘, 서버 랜덤 값(Server Random), SSL 인증서를 클라이언트에 전송한다.

    - **인증 :** 
        
        클라이언트는 CA를 통해 서버의 SSL 인증서를 검증하여 서버의 신뢰성을 확인한다.

    - **예비 마스터 암호(Premaster Secret) :** 
        클라이언트는 서버의 공개키로 암호화된 예비 마스터 암호를 전송하고, 서버는 개인키로 이를 복호화한다.

<br>

2. **키 데리베이션 과정**
    
      서버와 클라이언트는 각각 Client Random, Server Random, Pre-master Secret을 이용해 동일한 **대칭키(세션 키)**를 생성한다. 세션 키는 핸드셰이크 이후의 데이터를 암호화하고 복호화하는 데 사용된다​
        
<br>

3. **데이터 전송 과정**

      양측에서 생성한 **세션 키**를 사용해 `대칭 암호화 방식`으로 데이터를 안전하게 주고받는다. 핸드셰이크가 완료되면 클라이언트는 세션 키로 암호화된 "완료" 메시지를 서버에 보내고, 서버도 같은 방식으로 응답하며 암호화 통신이 시작된다.

<br>

4. **HTTPS 통신**

    안전하게 전달된 대칭키를 이용해 HTTPS를 통한 암호화된 데이터 통신이 이루어진다.

        
<br>

5. **세션 종료**

    세션이 종료되면 사용된 대칭키는 폐기된다. 이를 통해 키가 유출되더라도 과거의 데이터는 안전하게 보호된다.


<br>

### 장단점

**웹사이트의 무결성을 보호**
- HTTPS는 웹사이트와 사용자 간의 통신에서 데이터의 무결성을 보장한다.
- 중간에서 데이터가 변조되지 않았는지 확인할 수 있으며, 이는 인증서와 암호화를 통해 가능하다.



**침입자(악의적인 공격자, ISP 등)로부터 보호**
- 데이터를 암호화하여 중간에서 통신을 가로채는 공격자나 악의적인 행위자가 통신 내용을 읽거나 변조하지 못하도록 한다.


**SEO 최적화**
- HTTPS를 사용하는 웹사이트는 더 신뢰할 수 있다고 판단되어 검색 엔진 최적화에 반영된다.
- 즉, 키워드 검색 시 상위에 노출되는 기준 중 하나가 보안과 신뢰성이다.

**과부화와 속도 저하**
- 모든 데이터를 암호화하므로 처리 과정에서 추가적인 리소스가 필요하다.
- TLS 핸드쉐이크 과정이 있어 초기 연결 속도가 느릴 수 있지만, 성능 차이는 거의 미미하다.

**무조건 안전한 것은 아님**
- 신뢰할 수 없는 CA에서 발급된 인증서를 사용하거나 자가 서명 인증서(self-signed certificate)를 사용하는 경우, 실제로 그 사이트가 신뢰할 수 있는 사이트인지 검증할 수 없다.


<br>

### 예상면접 질문
- HTTP와 HTTPS의 차이점에 대해서 설명해주세요
- 공개키 암호화 방식과 대칭키 암호화 방식의 차이점에 대해 설명해주세요
-  TLS Handshake 과정을 설명해주세요


<br>

### 참고 자료 

[[cloudflare] HTTPS란 무엇입니까?](https://www.cloudflare.com/ko-kr/learning/ssl/what-is-https/)

[[cloudflare] TLS 핸드셰이크의 원리는 무엇일까요?  | SSL 핸드셰이크](https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake/)

[HTTPS란? (동작방식, 장단점)](https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake/)
